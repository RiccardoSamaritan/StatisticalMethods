---
title: "Univariate Analysis: Bike-Sharing Dataset"
author: "Statistical Analysis"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 3
    theme: readable
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.width = 8, fig.height = 5)
```

# Setup and Data Loading

```{r libraries}
library(corrplot)
library(GGally)
library(moments)
```

```{r load-data}
data <- read.csv("hour.csv")

# Factor labels for interpretability
data$season_lab <- factor(data$season, labels = c("Spring", "Summer", "Fall", "Winter"))
data$weather_lab <- factor(data$weathersit, labels = c("Clear", "Mist", "Light Snow/Rain", "Heavy Rain"))

# Dataset dimensions
cat("Observations:", nrow(data), "\nVariables:", ncol(data))
```
```{r}
library(dplyr)
library(lubridate)

data$dteday <- as.Date(data$dteday)

inizio <- min(data$dteday)
fine <- max(data$dteday)

timeline_teorica <- expand.grid(
  dteday = seq.Date(inizio, fine, by = "day"),
  hr = 0:23
)

check_gap <- timeline_teorica %>%
  left_join(data, by = c("dteday", "hr")) %>%
  filter(is.na(cnt)) # Filtriamo solo i record che non hanno riscontro nei tuoi dati
  
gap_per_giorno <- check_gap %>%
  group_by(dteday) %>%
  summarise(ore_mancanti = n()) %>%
  arrange(desc(ore_mancanti))
  
gap_per_giorno
```
**Note**: The dataset contains hourly bike rental data from 2011-01-01 to 2012-12-31. A completeness check reveals some missing hours on certain days. After investigations, these gaps are caused by natural disaster events (e.g., hurricane, snow storm) leading to station closures.
---

# Temporal Categorical Variables

## Season

```{r season}
# Frequency distribution
freq_season <- table(data$season_lab)
print(freq_season)

# Relative frequencies
prop.table(freq_season)

# Visualization
barplot(freq_season, main = "Season Distribution", 
        col = "lightblue", las = 2, ylab = "Frequency")

# Chi-square test for uniformity
chisq.test(freq_season)
```

**Interpretation**: Dataset is well-balanced across the four seasons (~25% each).

## Year

```{r year}
freq_year <- table(data$yr)
names(freq_year) <- c("2011", "2012")
print(freq_year)

barplot(freq_year, main = "Year Distribution", 
        col = "grey", ylab = "Frequency")

# Proportions
prop.table(freq_year)
```

## Month

```{r month}
freq_month <- table(data$mnth)
print(freq_month)

barplot(freq_month, main = "Monthly Distribution", 
        col = "lightgreen", xlab = "Month", ylab = "Frequency")

# Uniformity test
chisq.test(freq_month)
```

## Hour

```{r hour}
freq_hour <- table(data$hr)
print(summary(as.numeric(names(freq_hour))))

barplot(freq_hour, main = "Hourly Distribution", 
        col = "lavender", xlab = "Hour (0-23)", ylab = "Frequency")

# Uniformity test
chisq.test(freq_hour)
```


## Weekday

```{r weekday}
freq_weekday <- table(data$weekday)
names(freq_weekday) <- c("Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat")
print(freq_weekday)

barplot(freq_weekday, main = "Weekday Distribution", 
        col = "wheat", las = 2, ylab = "Frequency")

chisq.test(freq_weekday)
```

---

## Holiday

```{r holiday}
freq_holiday <- table(data$holiday)
names(freq_holiday) <- c("Non-Holiday", "Holiday")
print(freq_holiday)

# Holiday proportion
prop.table(freq_holiday)

barplot(freq_holiday, main = "Holiday Distribution", 
        col = "tomato", ylab = "Frequency")
```

**Note**: Proportion reflects the rarity of holidays in the calendar.

## Working Day

```{r workingday}
freq_working <- table(data$workingday)
names(freq_working) <- c("Non-Working", "Working")
print(freq_working)

prop.table(freq_working)

barplot(freq_working, main = "Working Day Distribution", 
        col = "steelblue", ylab = "Frequency")
```

**Interpretation**: About 70% of observations represent working days, consistent with standard calendar distribution.

## Weather Situation

```{r weather}
freq_weather <- table(data$weather_lab)
print(freq_weather)

# Proportions
prop.table(freq_weather)

barplot(freq_weather, main = "Weather Condition Distribution", 
        col = c("yellow", "lightgrey", "darkgrey", "black"), 
        las = 2, ylab = "Frequency")

# Chi-square test
chisq.test(freq_weather)
```

**Interpretation**: Most rentals occur during "Clear/Few Clouds" (Category 1). Category 4 (Heavy Rain/Snow) is extremely rare (n = 3), representing a rare event. Sharp class imbalance present.

---

# Continuous Variables (Normalized)

## Temperature (temp)

```{r temp}
# Descriptive statistics
cat("Temperature Statistics:\n")
summary(data$temp)
cat("\nStd Dev:", sd(data$temp), "\n")
cat("Coefficient of Variation:", sd(data$temp)/mean(data$temp), "\n")

# Visualization
par(mfrow = c(1, 3))
hist(data$temp, main = "Temperature Histogram", 
     col = "seagreen", border = "white", xlab = "Temp (normalized)", 
     probability = TRUE, breaks = 30)
lines(density(data$temp), col = "red", lwd = 2)

boxplot(data$temp, main = "Temperature Boxplot", col = "gold")

qqnorm(data$temp, main = "Q-Q Plot Temperature")
qqline(data$temp, col = "red")
par(mfrow = c(1, 1))

# Normality test
shapiro.test(sample(data$temp, 5000))
```

**Interpretation**: Roughly bimodal distribution, reflecting seasonal nature of data.

## Feeling Temperature (atemp)

```{r atemp}
cat("Feeling Temperature Statistics:\n")
summary(data$atemp)
cat("\nStd Dev:", sd(data$atemp), "\n")
cat("Coefficient of Variation:", sd(data$atemp)/mean(data$atemp), "\n")

par(mfrow = c(1, 3))
hist(data$atemp, main = "Feel Temperature Histogram", 
     col = "coral", border = "white", xlab = "ATemp (normalized)", 
     probability = TRUE, breaks = 30)
lines(density(data$atemp), col = "blue", lwd = 2)

boxplot(data$atemp, main = "Feel Temperature Boxplot", col = "lightblue")

qqnorm(data$atemp, main = "Q-Q Plot Feel Temperature")
qqline(data$atemp, col = "blue")
par(mfrow = c(1, 1))

shapiro.test(sample(data$atemp, 5000))
```

**Critical Note**: Extremely correlated with `temp` (r > 0.98), indicating redundant information.

## Humidity (hum)

```{r humidity}
cat("Humidity Statistics:\n")
summary(data$hum)
cat("\nStd Dev:", sd(data$hum), "\n")
cat("Coefficient of Variation:", sd(data$hum)/mean(data$hum), "\n")

par(mfrow = c(1, 3))
hist(data$hum, main = "Humidity Histogram", 
     col = "skyblue", border = "white", xlab = "Humidity (normalized)", 
     probability = TRUE, breaks = 30)
lines(density(data$hum), col = "darkblue", lwd = 2)

boxplot(data$hum, main = "Humidity Boxplot", col = "lightcyan")

qqnorm(data$hum, main = "Q-Q Plot Humidity")
qqline(data$hum, col = "darkblue")
par(mfrow = c(1, 1))

shapiro.test(sample(data$hum, 5000))

# Skewness
cat("\nSkewness:", moments::skewness(data$hum))
```

**Interpretation**: Slightly right-skewed distribution. Most records show humidity levels between 40% and 80%. Weak negative correlation with bike rentals (r ≈ -0.10), as very high humidity often correlates with rain or discomfort.

## Wind Speed (windspeed)

```{r windspeed}
cat("Wind Speed Statistics:\n")
summary(data$windspeed)
cat("\nStd Dev:", sd(data$windspeed), "\n")
cat("Coefficient of Variation:", sd(data$windspeed)/mean(data$windspeed), "\n")

par(mfrow = c(1, 3))
hist(data$windspeed, main = "Wind Speed Histogram", 
     col = "lightgreen", border = "white", xlab = "Wind Speed (normalized)", 
     probability = TRUE, breaks = 30)
lines(density(data$windspeed), col = "darkgreen", lwd = 2)

boxplot(data$windspeed, main = "Wind Speed Boxplot", col = "palegreen")

qqnorm(data$windspeed, main = "Q-Q Plot Wind Speed")
qqline(data$windspeed, col = "darkgreen")
par(mfrow = c(1, 1))

shapiro.test(sample(data$windspeed, 5000))
```

**Interpretation**: Left-skewed distribution. Significant number of records show "0" values, potentially representing near-calm conditions or sensor thresholds. High wind speeds are rare and typically act as a deterrent for casual users.

---

# Count Variables (Response Variables)

## Casual Users

```{r casual}
cat("Casual Users Statistics:\n")
summary(data$casual)
cat("\nStd Dev:", sd(data$casual), "\n")
cat("Coefficient of Variation:", sd(data$casual)/mean(data$casual), "\n")

par(mfrow = c(1, 2))
hist(data$casual, main = "Casual Users Distribution", 
     col = "orange", breaks = 50, xlab = "Count")

boxplot(data$casual, main = "Casual Users Boxplot", col = "peachpuff")
par(mfrow = c(1, 1))

# Skewness and kurtosis
cat("\nSkewness:", moments::skewness(data$casual), "\n")
cat("Kurtosis:", moments::kurtosis(data$casual), "\n")
```

**Interpretation**: Right-skewed count distribution. Casual users show sporadic, lower-volume behavior.

## Registered Users

```{r registered}
cat("Registered Users Statistics:\n")
summary(data$registered)
cat("\nStd Dev:", sd(data$registered), "\n")
cat("Coefficient of Variation:", sd(data$registered)/mean(data$registered), "\n")

par(mfrow = c(1, 2))
hist(data$registered, main = "Registered Users Distribution", 
     col = "purple", breaks = 50, xlab = "Count")

boxplot(data$registered, main = "Registered Users Boxplot", col = "plum")
par(mfrow = c(1, 1))

cat("\nSkewness:", moments::skewness(data$registered), "\n")
cat("Kurtosis:", moments::kurtosis(data$registered), "\n")
```

**Interpretation**: Registered users show much higher volume and drive overall dataset patterns.

## Total Count (cnt - Target Variable)

```{r total-count}
cat("Total Count Statistics:\n")
summary(data$cnt)
cat("\nStd Dev:", sd(data$cnt), "\n")
cat("Coefficient of Variation:", sd(data$cnt)/mean(data$cnt), "\n")

par(mfrow = c(1, 2))
hist(data$cnt, main = "Total Count Distribution", 
     col = "firebrick", breaks = 50, xlab = "Count")

boxplot(data$cnt, main = "Total Count Boxplot", col = "salmon")
par(mfrow = c(1, 1))

cat("\nSkewness:", moments::skewness(data$cnt), "\n")
cat("Kurtosis:", moments::kurtosis(data$cnt), "\n")

# Additive relationship verification
cat("\nVerification cnt = casual + registered:\n")
all.equal(data$cnt, data$casual + data$registered)
```

- **Distribution**: Strong right-skewed distribution. Most observations concentrated in lower range (0-200 rentals per hour), with long tail extending towards higher values.
- **Overdispersion**: Variance >> mean, indicating overdispersion typical of count data.
Logarithmic transformation might be beneficial for linear modeling to normalize residuals. Alternatively, Poisson or Negative Binomial regression more appropriate than standard OLS.

---

# Correlation Analysis

```{r correlation-matrix}
# Numeric variable selection
vars_numeric <- c("season", "yr", "mnth", "hr", "holiday", "weekday", 
                  "workingday", "weathersit", "temp", "atemp", "hum", 
                  "windspeed", "casual", "registered", "cnt")

cor_matrix <- cor(data[, vars_numeric])

# Correlation matrix visualization
corrplot(cor_matrix, method = "color", type = "upper", 
         tl.cex = 0.7, tl.col = "black", 
         title = "Correlation Matrix", 
         mar = c(0,0,2,0),
         addCoef.col = "black", number.cex = 0.5)
```

```{r correlation-target}
# Correlations with target variable (cnt)
cor_with_target <- sort(cor_matrix[, "cnt"], decreasing = TRUE)
print(cor_with_target)

# Visualization of strongest correlations with cnt
barplot(cor_with_target[abs(cor_with_target) > 0.3], 
        main = "Correlations with Total Count (|r| > 0.3)", 
        col = ifelse(cor_with_target[abs(cor_with_target) > 0.3] > 0, "forestgreen", "red"),
        las = 2, cex.names = 0.8)
abline(h = 0)
```

**Key Correlations**:

- **temp/atemp ↔ cnt**: positive correlation (r ≈ 0.4)
- **hr ↔ cnt**: Moderate correlation showing distinct daily pattern with commuting hour peaks
- **hum ↔ cnt**: Weak negative correlation
- **Multicollinearity Alert**: Severe redundancy between `temp` and `atemp` (r > 0.98)

---

# Bivariate Relationships (Exploratory)

```{r scatterplot-matrix}
# Environmental variables vs target
ggpairs(data[, c("temp", "atemp", "hum", "windspeed", "cnt")], 
        title = "Environmental Variables vs Total Count",
        lower = list(continuous = "smooth"))
```

---

# Complete Statistical Summary

```{r summary-complete}
# Complete numerical summary
summary(data[, vars_numeric])
```

---

